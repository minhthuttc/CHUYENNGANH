<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ki·ªÉm Tra Server</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header>
        <nav>
            <a href="index.html" class="logo">üé® DesignHub</a>
        </nav>
    </header>

    <main class="container">
        <h1>üîç Ki·ªÉm Tra Server</h1>

        <div class="card" style="margin: 2rem 0;">
            <h2>Tr·∫°ng Th√°i Server</h2>
            <button onclick="checkServer()" class="btn btn-primary">
                üîÑ Ki·ªÉm Tra Ngay
            </button>
            <div id="serverStatus" style="margin-top: 1rem;"></div>
        </div>

        <div class="card" style="margin: 2rem 0;">
            <h2>Test API ƒêƒÉng K√Ω</h2>
            <button onclick="testRegisterAPI()" class="btn btn-secondary">
                üß™ Test API
            </button>
            <div id="apiStatus" style="margin-top: 1rem;"></div>
        </div>

        <div class="card" style="margin: 2rem 0; background: var(--light-brown);">
            <h3>üìã H∆∞·ªõng D·∫´n S·ª≠a L·ªói</h3>
            <ol style="margin-left: 1.5rem; line-height: 2;">
                <li><strong>Ki·ªÉm tra server ƒëang ch·∫°y:</strong>
                    <br>M·ªü terminal v√† ch·∫°y: <code>node server.js</code>
                </li>
                <li><strong>Ki·ªÉm tra MongoDB:</strong>
                    <br>ƒê·∫£m b·∫£o MongoDB ƒë√£ k·∫øt n·ªëi th√†nh c√¥ng
                </li>
                <li><strong>Ki·ªÉm tra file .env:</strong>
                    <br>Ph·∫£i c√≥ MONGODB_URI v√† JWT_SECRET
                </li>
                <li><strong>Ki·ªÉm tra console log:</strong>
                    <br>Xem terminal c√≥ l·ªói g√¨ kh√¥ng
                </li>
            </ol>
        </div>

        <div class="card" style="margin: 2rem 0;">
            <h3>üõ†Ô∏è C√°c L·ªánh H·ªØu √çch</h3>
            <div style="background: #f5f5f5; padding: 1rem; border-radius: 5px; font-family: monospace;">
                <p># Kh·ªüi ƒë·ªông server</p>
                <p style="color: #28a745;">node server.js</p>
                <br>
                <p># Ki·ªÉm tra port 3000</p>
                <p style="color: #28a745;">netstat -ano | findstr :3000</p>
                <br>
                <p># Kill process tr√™n port 3000 (n·∫øu b·ªã chi·∫øm)</p>
                <p style="color: #28a745;">npx kill-port 3000</p>
            </div>
        </div>
    </main>

    <script>
        const API_URL = 'http://localhost:3000/api';

        async function checkServer() {
            const statusDiv = document.getElementById('serverStatus');
            statusDiv.innerHTML = '<p>‚è≥ ƒêang ki·ªÉm tra...</p>';

            try {
                // Test basic API
                const response = await fetch(`${API_URL}/test`, {
                    method: 'GET'
                });

                if (response.ok) {
                    const data = await response.json();
                    statusDiv.innerHTML = `
                        <div style="padding: 1rem; background: #d4edda; border: 1px solid #c3e6cb; border-radius: 5px; color: #155724;">
                            <strong>‚úÖ Server ƒëang ch·∫°y!</strong><br>
                            Status: ${data.status}<br>
                            Message: ${data.message}<br>
                            URL: ${API_URL}
                        </div>
                    `;
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                statusDiv.innerHTML = `
                    <div style="padding: 1rem; background: #f8d7da; border: 1px solid #f5c6cb; border-radius: 5px; color: #721c24;">
                        <strong>‚ùå Server kh√¥ng ch·∫°y!</strong><br>
                        L·ªói: ${error.message}<br><br>
                        <strong>Gi·∫£i ph√°p:</strong><br>
                        1. M·ªü terminal<br>
                        2. Ch·∫°y: <code>node server.js</code><br>
                        3. ƒê·ª£i th√¥ng b√°o "Server ƒëang ch·∫°y"<br>
                        4. Th·ª≠ l·∫°i
                    </div>
                `;
            }
        }

        async function testRegisterAPI() {
            const statusDiv = document.getElementById('apiStatus');
            statusDiv.innerHTML = '<p>‚è≥ ƒêang test API...</p>';

            const testData = {
                fullName: 'Test User ' + Date.now(),
                email: 'test_' + Date.now() + '@example.com',
                password: '123456',
                userType: 'client'
            };

            try {
                console.log('Sending test registration:', testData);

                const response = await fetch(`${API_URL}/auth/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(testData)
                });

                const data = await response.json();
                console.log('Response:', data);

                if (response.ok) {
                    statusDiv.innerHTML = `
                        <div style="padding: 1rem; background: #d4edda; border: 1px solid #c3e6cb; border-radius: 5px; color: #155724;">
                            <strong>‚úÖ API ho·∫°t ƒë·ªông t·ªët!</strong><br>
                            Status: ${response.status}<br>
                            Message: ${data.message}<br>
                            User ID: ${data.userId}<br><br>
                            <strong>Th√¥ng tin test:</strong><br>
                            Email: ${testData.email}<br>
                            Password: ${testData.password}
                        </div>
                    `;
                } else {
                    statusDiv.innerHTML = `
                        <div style="padding: 1rem; background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 5px; color: #856404;">
                            <strong>‚ö†Ô∏è API tr·∫£ v·ªÅ l·ªói</strong><br>
                            Status: ${response.status}<br>
                            Message: ${data.message}<br><br>
                            <strong>Chi ti·∫øt:</strong><br>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                }
            } catch (error) {
                statusDiv.innerHTML = `
                    <div style="padding: 1rem; background: #f8d7da; border: 1px solid #f5c6cb; border-radius: 5px; color: #721c24;">
                        <strong>‚ùå L·ªói k·∫øt n·ªëi API!</strong><br>
                        L·ªói: ${error.message}<br><br>
                        <strong>C√≥ th·ªÉ do:</strong><br>
                        1. Server ch∆∞a ch·∫°y<br>
                        2. MongoDB ch∆∞a k·∫øt n·ªëi<br>
                        3. Route /auth/register ch∆∞a ƒë∆∞·ª£c ƒëƒÉng k√Ω<br>
                        4. L·ªói trong User model<br><br>
                        <strong>Ki·ªÉm tra:</strong><br>
                        - Xem terminal server c√≥ l·ªói kh√¥ng<br>
                        - Xem console log (F12)
                    </div>
                `;
                console.error('Error:', error);
            }
        }

        // Auto check on load
        window.addEventListener('load', () => {
            checkServer();
        });
    </script>
</body>
</html>
