<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo Thanh To√°n - DesignHub</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header>
        <nav>
            <a href="index.html" class="logo">üé® DesignHub</a>
            <ul class="nav-links">
                <li><a href="dashboard.html">Dashboard</a></li>
                <li><a href="payment-history.html">L·ªãch S·ª≠</a></li>
                <li><a href="test-payment.html">Test</a></li>
            </ul>
        </nav>
    </header>

    <main class="container">
        <h1>üöÄ Demo T√≠nh NƒÉng Thanh To√°n</h1>
        
        <div class="card" style="margin: 2rem 0;">
            <h2>H∆∞·ªõng D·∫´n Nhanh</h2>
            <ol style="margin-left: 1.5rem; line-height: 2;">
                <li>ƒêƒÉng nh·∫≠p v√†o h·ªá th·ªëng</li>
                <li>T·∫°o ho·∫∑c ch·ªçn m·ªôt d·ª± √°n</li>
                <li>Nh·∫•n v√†o n√∫t b√™n d∆∞·ªõi ƒë·ªÉ test thanh to√°n</li>
            </ol>
        </div>

        <div class="card-grid">
            <div class="card">
                <h3>üí≥ Trang Thanh To√°n</h3>
                <p>Thanh to√°n cho d·ª± √°n v·ªõi nhi·ªÅu ph∆∞∆°ng th·ª©c</p>
                <button onclick="openPaymentDemo()" class="btn btn-primary" style="width: 100%; margin-top: 1rem;">
                    M·ªü Trang Thanh To√°n
                </button>
            </div>

            <div class="card">
                <h3>üìú L·ªãch S·ª≠ Giao D·ªãch</h3>
                <p>Xem t·∫•t c·∫£ giao d·ªãch ƒë√£ th·ª±c hi·ªán</p>
                <button onclick="window.location.href='payment-history.html'" class="btn btn-primary" style="width: 100%; margin-top: 1rem;">
                    Xem L·ªãch S·ª≠
                </button>
            </div>

            <div class="card">
                <h3>üß™ Test API</h3>
                <p>Test c√°c API endpoint thanh to√°n</p>
                <button onclick="window.location.href='test-payment.html'" class="btn btn-primary" style="width: 100%; margin-top: 1rem;">
                    M·ªü Test Page
                </button>
            </div>
        </div>

        <div class="card" style="margin-top: 2rem; background: var(--light-brown);">
            <h3>üìã C√°c T√≠nh NƒÉng ƒê√£ Ho√†n Th√†nh</h3>
            <ul style="margin-left: 1.5rem; line-height: 2;">
                <li>‚úÖ Trang thanh to√°n v·ªõi 4 ph∆∞∆°ng th·ª©c</li>
                <li>‚úÖ T√≠nh ph√≠ d·ªãch v·ª• t·ª± ƒë·ªông (5%)</li>
                <li>‚úÖ L·ªãch s·ª≠ giao d·ªãch v·ªõi b·ªô l·ªçc</li>
                <li>‚úÖ Th·ªëng k√™ thu/chi</li>
                <li>‚úÖ Validation v√† x·ª≠ l√Ω l·ªói</li>
                <li>‚úÖ C·∫≠p nh·∫≠t tr·∫°ng th√°i d·ª± √°n t·ª± ƒë·ªông</li>
                <li>‚úÖ Responsive design</li>
            </ul>
        </div>

        <div class="card" style="margin-top: 2rem;">
            <h3>üîó Quick Links</h3>
            <div style="display: grid; gap: 0.5rem; margin-top: 1rem;">
                <a href="my-projects.html" class="btn btn-primary">
                    üìÅ D·ª± √Ån C·ªßa T√¥i (Xem & Thanh To√°n)
                </a>
                <a href="payment-history.html" class="btn btn-secondary">
                    üìú L·ªãch S·ª≠ Thanh To√°n
                </a>
                <a href="test-payment.html" class="btn btn-secondary">
                    üß™ Test API
                </a>
                <a href="HUONG_DAN_THANH_TOAN.md" class="btn btn-secondary" target="_blank">
                    üìñ Documentation
                </a>
            </div>
        </div>

        <div class="card" style="margin-top: 2rem; border: 2px solid var(--dark-brown);">
            <h3>‚ö° T·∫°o D·ª± √Ån Demo Nhanh</h3>
            <p>T·∫°o m·ªôt d·ª± √°n m·∫´u ƒë·ªÉ test thanh to√°n</p>
            <button onclick="createDemoProject()" class="btn btn-primary" style="width: 100%; margin-top: 1rem;">
                üé® T·∫°o D·ª± √Ån Demo
            </button>
            <div id="demoResult" style="margin-top: 1rem; display: none;"></div>
        </div>
    </main>

    <footer>
        <p>&copy; 2025 DesignHub - Demo Payment System</p>
    </footer>

    <script>
        const API_URL = 'http://localhost:3000/api';

        async function openPaymentDemo() {
            try {
                // L·∫•y d·ª± √°n ƒë·∫ßu ti√™n
                const response = await fetch(`${API_URL}/projects`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });

                if (!response.ok) {
                    alert('Vui l√≤ng ƒëƒÉng nh·∫≠p tr∆∞·ªõc!');
                    window.location.href = 'login.html';
                    return;
                }

                const projects = await response.json();
                
                if (projects.length === 0) {
                    if (confirm('Ch∆∞a c√≥ d·ª± √°n n√†o. B·∫°n c√≥ mu·ªën t·∫°o d·ª± √°n demo kh√¥ng?')) {
                        await createDemoProject();
                    }
                    return;
                }

                // M·ªü trang thanh to√°n v·ªõi d·ª± √°n ƒë·∫ßu ti√™n
                window.location.href = `payment.html?projectId=${projects[0]._id}`;
            } catch (error) {
                console.error('Error:', error);
                alert('L·ªói! Vui l√≤ng ƒëƒÉng nh·∫≠p tr∆∞·ªõc.');
                window.location.href = 'login.html';
            }
        }

        async function createDemoProject() {
            const resultDiv = document.getElementById('demoResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<p>‚è≥ ƒêang t·∫°o d·ª± √°n demo...</p>';

            try {
                const user = JSON.parse(localStorage.getItem('user'));
                
                const demoProject = {
                    title: 'Demo - Thi·∫øt K·∫ø Logo ' + Date.now(),
                    description: 'D·ª± √°n demo ƒë·ªÉ test t√≠nh nƒÉng thanh to√°n',
                    category: 'Logo Design',
                    budget: 5000000,
                    deadline: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(),
                    status: 'review', // Tr·∫°ng th√°i s·∫µn s√†ng thanh to√°n
                    client: user._id
                };

                const response = await fetch(`${API_URL}/projects`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: JSON.stringify(demoProject)
                });

                if (response.ok) {
                    const project = await response.json();
                    resultDiv.innerHTML = `
                        <div style="background: white; padding: 1rem; border-radius: 5px; border: 1px solid var(--border-color);">
                            <p style="color: green; font-weight: bold;">‚úÖ T·∫°o d·ª± √°n th√†nh c√¥ng!</p>
                            <p><strong>T√™n:</strong> ${project.title}</p>
                            <p><strong>Ng√¢n s√°ch:</strong> ${project.budget.toLocaleString('vi-VN')} VNƒê</p>
                            <button onclick="window.location.href='payment.html?projectId=${project._id}'" 
                                    class="btn btn-primary" style="width: 100%; margin-top: 1rem;">
                                üí≥ Thanh To√°n Ngay
                            </button>
                        </div>
                    `;
                } else {
                    const error = await response.json();
                    resultDiv.innerHTML = `<p style="color: red;">‚ùå L·ªói: ${error.message}</p>`;
                }
            } catch (error) {
                console.error('Error:', error);
                resultDiv.innerHTML = `<p style="color: red;">‚ùå L·ªói: ${error.message}</p>`;
            }
        }

        // Check auth on load
        if (!localStorage.getItem('token')) {
            if (confirm('B·∫°n ch∆∞a ƒëƒÉng nh·∫≠p. Chuy·ªÉn ƒë·∫øn trang ƒëƒÉng nh·∫≠p?')) {
                window.location.href = 'login.html';
            }
        }
    </script>
</body>
</html>
